Data Science Midterm
================
Nick Williams

### Importing data

``` r
accel_data <- read_csv("./data/p8105_mtp_data.csv") %>% 
  janitor::clean_names()
```

### Cleaning data

``` r
accel_data <- accel_data %>% 
  gather(key = "minute", value = "activity_count", activity_1:activity_1440) %>% 
  separate(minute, into = c("axe", "minute"), sep = "_") %>% 
  select(-axe) %>% 
  mutate(day = as_factor(day), 
         day = fct_relevel(day, c("Sunday", "Monday", "Tuesday", "Wednesday", 
                                  "Thursday", "Friday", "Saturday")),
         minute = as.integer(minute), 
         hour = cut(minute, breaks = c(-Inf, 61, 121, 181, 241, 301, 361, 
                                       421, 481, 541, 601, 661, 721, 781, 
                                       841, 901, 961, 1021, 1081, 1141, 1201, 
                                       1261, 1321, 1381, 1441), 
                    labels = c(1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 
                               13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24)
         ), 
         week_fct = as.factor(week), 
         week_fct = fct_collapse(week_fct, 
                                 "1 - 5" = c("1", "2", "3", "4", "5"),
                                 "6 - 10" = c("6", "7", "8", "9", "10"), 
                                 "11 - 15" = c("11", "12", "13", "14", "15"),
                                 "16 - 20" = c("16", "17", "18", "19", "20"), 
                                 "21 - 25" = c("21", "22", "23", "24", "25"), 
                                 "26 - 30" = c("26", "27", "28", "29", "30"), 
                                 "31 - 35" = c("31", "32", "33", "34", "35"), 
                                 "36 - 40" = c("36", "37", "38", "39", "40", "41"), 
                                 "41 - 47" = c("42", "43", "44", "45", "46", "47"))
  )
```

The first steps in this analysis required importing and tidying the data. I first transformed the dataset from wide form to long form (using the variables activity\_1 to activity\_1440) by creating a new variable called minute that records what minute of the day each row corresponds to. I then created a new variable called hour that recorded what hour of the day each observation belonged to. Lastly, I created another week variable that collapsed the weeks into 5/6 week intervals. I also ordered the day variable so that the factor levels followed the actual order of the week.

The cleaned accelerametor dataset contains 473760 observations/minutes and 6 variables. Variables include the week, day, hour, and minute. Ultimately, the data represents 329 days or 19740 hours worth of data. The data is highly right skewed due to the presence of outliers; as such, in addition to total activity, the median and/or geometric mean are used throughout this analysis. The median and geometric average activity count throughout the entire observation period were 43 and 21.5 respectively. The modal activity count was 1, indicating no activity, with 204507 observed minutes.

### Exploratory analyses

``` r
density_full <- accel_data %>% 
  mutate(log_actvty_count = log(activity_count)) %>% 
  ggplot(aes(x = log_actvty_count, color = week_fct)) +
  geom_density(size = 0.75, fill = "grey", alpha = 0.1) + 
  viridis::scale_color_viridis(discrete = TRUE, 
                               name = "Week", 
                               option = "cividis") + 
  labs(x = "Log Activity Count", 
       y = "Density") + 
  theme(legend.position = c(.93, .55), 
        legend.key.size = unit(.1, "in"),
        legend.title = element_text(size = 10), 
        legend.background = element_blank(), 
        legend.box.background = element_rect(color = "black"))

density_zoom_1 <- accel_data %>% 
  mutate(log_actvty_count = log(activity_count)) %>% 
  ggplot(aes(x = log_actvty_count, color = week_fct)) +
  geom_density(size = 0.75, fill = "grey", alpha = 0.1) + 
  coord_cartesian(xlim = c(0, 1)) + 
  viridis::scale_color_viridis(discrete = TRUE, 
                               guide = FALSE, 
                               option = "cividis") + 
  labs(caption = "Log activity zoomed between 0 and 1") + 
  theme(axis.title.x = element_blank(), 
        axis.title.y = element_blank())

density_zoom_2 <- accel_data %>% 
  mutate(log_actvty_count = log(activity_count)) %>% 
  ggplot(aes(x = log_actvty_count, color = week_fct)) +
  geom_density(size = 0.75, fill = "grey", alpha = 0.1) + 
  coord_cartesian(xlim = c(2, 8), ylim = c(0, 0.3)) + 
  viridis::scale_color_viridis(discrete = TRUE, 
                               guide = FALSE, 
                               option = "cividis") +  
  labs(caption = "Log activity zoomed between 2 and 8") + 
  theme(axis.title.x = element_blank(), 
        axis.title.y = element_blank())

wrap_elements(density_full / (density_zoom_1 + density_zoom_2)) + 
  ggtitle("Density plots of log activity count with zoomed axis")
```

<img src="p8105_mtp_ntw2117_files/figure-markdown_github/density plots of activity over the weeks-1.png" width="80%" style="display: block; margin: auto;" />

I plotted the distribution of the log activity counts stratified by weekly intervals. This can be seen in the above figure. The density plot is characterized by two distinct peaks centered around zero and six. Interestingly, the peak centered around zero (indicating minimal activity) begins to decrease as time moves forward while the peak centered around six begins to increase. This is the first indication that the individuals activity may have increased over time.

``` r
geo_agg_activity <- accel_data %>% 
  group_by(day) %>% 
  mutate(log_actvty = log(activity_count)) %>% 
  summarize(geo_avg_actvty = exp(mean(log_actvty))) %>%
  ggplot(aes(x = day, y = geo_avg_actvty)) + 
  geom_point(size = 4, color = "#A35E60") + 
  geom_line(group = 1) + 
  labs(title = "Geometric average activity by the day of the week", 
       x = "Day of the week", 
       y = "Geometric average activity count")

total_agg_activity <- accel_data %>% 
  group_by(day) %>% 
  summarize(total_actvty = sum(activity_count)) %>%
  ggplot(aes(x = day, y = total_actvty)) + 
  geom_point(size = 4, color = "#A35E60") + 
  geom_line(group = 1) + 
  labs(title = "Total activity by the day of the week", 
       x = "Day of the week", 
       y = "Total activity count")

total_agg_activity + geo_agg_activity
```

<img src="p8105_mtp_ntw2117_files/figure-markdown_github/activity by day line plot-1.png" width="100%" style="display: block; margin: auto;" />

I also explored the effect of weekday on activity. The figure above shows total activity and the geometric mean of activity across the days of the week aggregated across all weeks. The lowest total activity occurs on Tuesdays while the highest among occurs on Friday's. Interestingly, however, based on the geometric mean, we'd expect that the lowest activity during any week would occur on Sunday instead of Tuesday.

``` r
med_actvty_all_days <- accel_data %>% 
  group_by(hour) %>% 
  summarize(med_activity = median(activity_count)) %>% 
  mutate(day = as.factor("All days"), 
         hour = as.double(hour))

accel_data %>% 
  mutate(hour = as.double(hour)) %>% 
  group_by(hour, day) %>% 
  summarize(med_activity = median(activity_count)) %>% 
  ggplot(aes(x = hour, y = med_activity, color = day)) +
  geom_line(size = 1, alpha = 0.5) + 
  geom_line(data = med_actvty_all_days, lty = "dashed", size = 1.5) + 
  viridis::scale_color_viridis(name = "Day of the week", 
                               discrete = TRUE, 
                               option = "viridis",
                               breaks = c("All days", "Sunday", "Monday", "Tuesday",
                                          "Wednesday", "Thursday", "Friday", "Saturday")) + 
  scale_x_continuous(limits = c(0, 24), 
                     breaks = c(0, 2, 4, 6, 8, 10, 12, 14, 16, 18, 20, 22, 24)) + 
  scale_y_continuous(minor_breaks = seq(0, 300, 25)) + 
  labs(title = "Activity count throughout the day stratified by day of the week",
       x = "Hour of the Day (24 hour clock)", 
       y = "Median Activity Count", 
       caption = "Data provided by Jeff Goldsmith, PhD") + 
  theme(legend.position = c(.05, 1), 
        legend.justification = c(0, 1.1), 
        legend.key.size = unit(.1, "in"),
        legend.title = element_text(size = 10), 
        legend.background = element_blank(), 
        legend.box.background = element_rect(color = "black"))
```

<img src="p8105_mtp_ntw2117_files/figure-markdown_github/median activity by day and hour-1.png" width="70%" style="display: block; margin: auto;" />

Furthermore, I investigated the effect of time of day on activity. The above figure shows trends in median hourly activity stratified by weekday as well as across all days. Activity appears to be relatively constant during daytime hours. However, there are peaks in activity on Thursday and Friday between 6 p.m. and 9 p.m.

``` r
total_actvty <- accel_data %>% 
  group_by(week) %>% 
  summarize(total_actvty = sum(activity_count)) %>% 
  ggplot(aes(x = week, y = total_actvty)) + 
  geom_line() + 
  geom_smooth(color = "#A35E60", se = FALSE) + 
  labs(y = "Total Activity") + 
  theme(axis.title.x = element_blank())

total_actvty_week_day <- accel_data %>% 
  group_by(week, day) %>% 
  summarize(total_actvty = sum(activity_count)) %>% # using geometric mean due to how skewed data is
  ggplot(aes(x = week, y = total_actvty)) + 
  facet_grid(~ day) + 
  geom_line() + 
  labs(x = "Week", 
       y = "Total Activity") + 
  geom_smooth(color = "#A35E60", se = FALSE) + 
  theme(strip.background = element_blank(), 
        strip.text = element_text(color = "black")
  )

wrap_elements(total_actvty / total_actvty_week_day) + 
  ggtitle("Trends in total activity over the observation period")
```

<img src="p8105_mtp_ntw2117_files/figure-markdown_github/total activity across weeks-1.png" width="100%" style="display: block; margin: auto;" />

Lastly, I analyzed the how total activity changed across the whole observation period. The above figure shows the trend in activity across all 47 weeks alone and stratified by day of the week. As time increases, it appears that total activity does increase as well. It also appears that total activity was more variable towards the beginning of the study and became more consistent towards the end. An increase in activity is observed across all days over the observation period. The trend of increase follows a similar pattern across all the days. However, for Saturday after week 35 there is a decrease in activity. Furthermore, it appears the rate of increase tapers off towards the end of the observation period.
